{% extends 'base.html' %}
{% set active_page = 'admin' %}

{% block content %}

<h3>{{ title }}</h3>

<!-- Section for the search form inputs -->
<div class="my-3">
    <form method="GET" novalidate>
        <div class="form-row">
            <div class="col-md-6 mb-2">
                {{ form.course.label }}
                {{ form.course(class="form-control") }}
            </div>
            <div class="col-md-6 mb-2">
                {{ form.year.label }}
                {{ form.year(class="form-control") }}
            </div>
            <div class="col-md-6 mb-2">
                {{ form.author.label }}
                {{ form.author(class="form-control") }}
            </div>
            <div class="col-md-6 mb-2">
                {{ form.tag.label }}
                {{ form.tag(class="form-control") }}
            </div>
            <div class="col-md-12 my-3">
                {{ form.search(class="btn btn-primary float-right") }}
                <a class="btn btn-secondary float-right mx-2" href="{{ url_for('admin.manage') }}">
                Clear search
                </a>
            </div>
        </div>
    </form>
</div>
<!-- Section that shows the result from the search -->
<div class="my-3">
    <table class="table table-striped table-bordered my-3">
        <thead>
            <tr>
                <th>Title</th>
                <th>Course</th>
                <th>Year</th>
                <th>Tag</th>
                <th>Author</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for puzzle in puzzles_page.items %}
            <tr>
                <td><a href="{{ url_for('puzzle.puzzle_detail', program_url = puzzle.url)}}">{{ puzzle.title }}</a></td>
                <td>{{ puzzle.course.name }}</td>
                <td>{{ puzzle.course.year }}</td>
                <td>{% if puzzle.tag %} {{ puzzle.tag.name }} {% endif %}</td>
                <td>{{ puzzle.author }}</td>
                <td>
                    <a class="btn btn-warning" href="{{ url_for('admin.puzzle_delete', id = puzzle.id) }}">
                        <i class="fa fa-trash fa-lg button-icon"></i>
                        Delete
                    </a>
                </td>
                <td>
                    <a class="btn btn-primary" href="{{ url_for('admin.edit_puzzle', id = puzzle.id) }}">
                        <i class="fas fa-edit fa-lg button-icon"></i>
                        Edit
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <ul class="pagination">
        {% for page in puzzles_page.iter_pages() %}
        {% if page != puzzles_page.page %}
        <li class="page-item">
            <a class="page-link" 
                href="{{ url_for('admin.manage', page = loop.index, tag = form.tag.data,
                    course = form.course.data, year = form.year.data, author = form.author.data) }}">
                {{ loop.index }}
            </a>
        </li>
        {% else %}
        <li class="page-item">
            <a class="page-link active">{{ page }}</a>
        <li class="page-item">
        {% endif %}
    {% endfor %}
    </ul>
</div>
{% endblock %}